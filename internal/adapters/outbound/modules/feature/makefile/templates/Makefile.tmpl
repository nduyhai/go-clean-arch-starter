.PHONY: all build run test lint fmt tidy deps clean tools help

APP_NAME := {{ .Name }}
MODULE   := {{ .Module }}
GO       ?= go

all: build

build:
	$(GO) build ./...

run:
	$(GO) run ./cmd/{{ .Name }}

test:
	$(GO) test ./... -race -count=1 -cover

lint:
	@command -v golangci-lint >/dev/null 2>&1 && golangci-lint run || echo "golangci-lint not installed; skipping"

fmt:
	$(GO) fmt ./...

mod:
	$(GO) mod tidy
	$(GO) mod download

deps:
	$(GO) list -m all > /dev/null

clean:
	rm -rf dist

help:
	@echo "Common targets:"
	@echo "  build  - Build all packages"
	@echo "  run    - Run cmd/api (if present)"
	@echo "  test   - Run tests with race and coverage"
	@echo "  lint   - Run golangci-lint if installed"
	@echo "  fmt    - go fmt all packages"
	@echo "  mod    - go mod tidy && go mod download"
	@echo "  deps   - list module dependencies (populate cache)"
	@echo "  clean  - clean build artifacts"
